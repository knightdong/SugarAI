<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Character - Sugar.AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #212121 0%, #1a1a1a 100%);
            color: #ffffff;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* 左侧导航栏 */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #2a2a2a 0%, #1e1e1e 100%);
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            border-right: 1px solid #333;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
        }

        .logo {
            padding: 30px 25px;
            text-align: center;
            border-bottom: 1px solid #333;
            cursor: pointer;
        }

        .logo h1 {
            color: #ed7f8c;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .logo p {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
            letter-spacing: 1px;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 18px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            position: relative;
        }

        .nav-item:hover {
            background: linear-gradient(90deg, rgba(237, 127, 140, 0.1) 0%, transparent 100%);
            border-left-color: #ed7f8c;
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(237, 127, 140, 0.15) 0%, transparent 100%);
            border-left-color: #ed7f8c;
        }

        .nav-item .icon {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            color: #ed7f8c;
            font-size: 20px;
        }

        .nav-item .text {
            font-size: 16px;
            font-weight: 500;
            color: #ffffff;
        }

        .nav-item .text.active {
            color: #ed7f8c;
        }

        /* 用户信息区域 */
        .user-section {
            position: absolute;
            bottom: 20px;
            left: 25px;
            right: 25px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(237, 127, 140, 0.1) 0%, rgba(237, 127, 140, 0.05) 100%);
            border-radius: 12px;
            border: 1px solid rgba(237, 127, 140, 0.2);
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .user-details h4 {
            color: #ffffff;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .user-details p {
            color: #999;
            font-size: 12px;
        }

        .gem-balance {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .gem-info {
            display: flex;
            align-items: center;
        }

        .gem-icon {
            color: #ed7f8c;
            margin-right: 6px;
        }

        .gem-count {
            color: #ed7f8c;
            font-weight: bold;
        }

        /* 主内容区域 */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: calc(100vw - 280px);
            height: 100vh;
            overflow-y: auto;
        }

        .content-header {
            margin-bottom: 30px;
            text-align: center;
            width: 100%;
            max-width: 800px;
        }

        .content-title {
            font-size: 32px;
            font-weight: 700;
            color: #ed7f8c;
            margin-bottom: 10px;
        }

        .content-subtitle {
            font-size: 16px;
            color: #999;
            margin-bottom: 30px;
        }

        /* 进度条 */
        .progress-container {
            width: 100%;
            max-width: 800px;
            margin-bottom: 30px;
        }

        .progress-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .progress-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #333;
            border: 2px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: #666;
            transition: all 0.3s ease;
            flex-shrink: 0;
            position: relative;
        }

        .progress-step.active {
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            border-color: #ed7f8c;
            color: white;
            box-shadow: 0 0 0 3px rgba(237, 127, 140, 0.3);
        }

        .progress-step.completed {
            background: #ed7f8c;
            border-color: #ed7f8c;
            color: white;
            box-shadow: 0 0 0 2px rgba(237, 127, 140, 0.2);
        }

        .progress-line {
            width: 60px;
            height: 2px;
            background: #333;
            transition: all 0.3s ease;
        }

        .progress-line.completed {
            background: #ed7f8c;
        }

        /* 步骤内容 */
        .step-container {
            width: 100%;
            background: linear-gradient(145deg, #2a2a2a, #1e1e1e);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid #333;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
        }

        .step-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .step-title {
            font-size: 28px;
            font-weight: 700;
            color: #ed7f8c;
            margin-bottom: 15px;
            text-align: center;
        }

        .step-subtitle {
            font-size: 16px;
            color: #999;
            margin-bottom: 40px;
            text-align: center;
        }

        /* 选择项网格 */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            flex: 1;
        }

        /* Style步骤的网格 - 居中显示 */
        .options-grid.style-grid {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        /* 图标类型的网格 */
        .options-grid.icon-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .option-card {
            background: linear-gradient(145deg, #333, #2a2a2a);
            border: 2px solid #444;
            border-radius: 20px;
            padding: 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            aspect-ratio: 3/4;
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }

        .option-image {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-color: #555;
            position: relative;
        }

        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(237, 127, 140, 0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .option-card:hover::before {
            opacity: 1;
        }

        .option-card:hover {
            border-color: #ed7f8c;
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(237, 127, 140, 0.3);
        }

        .option-card.selected {
            border-color: #ed7f8c;
            box-shadow: 0 15px 40px rgba(237, 127, 140, 0.3);
        }

        .option-card.selected::after {
            content: '✓';
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: #ed7f8c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: bold;
            z-index: 3;
        }

        .option-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.3) 30%, rgba(0, 0, 0, 0.8) 100%);
            z-index: 2;
        }

        .option-title {
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .option-description {
            font-size: 14px;
            color: #ccc;
            line-height: 1.4;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* 图标类型的选项卡 */
        .option-card.icon-card {
            aspect-ratio: auto;
            padding: 25px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .option-card.icon-card .option-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        /* 人种图片样式 */
        .option-card.icon-card .option-image {
            width: 80px;
            height: 80px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 50%;
            margin-bottom: 15px;
            border: 3px solid #444;
            transition: all 0.3s ease;
            background-color: #333;
            position: relative;
        }

        .option-card.icon-card.selected .option-image {
            border-color: #ed7f8c;
        }

        /* 图片加载失败时的回退样式 */
        .option-card.icon-card .option-image.error {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #999;
        }

        .option-card.icon-card .option-image.error::before {
            content: '📷';
        }

        .option-card.icon-card .option-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
            text-shadow: none;
        }

        .option-card.icon-card .option-description {
            font-size: 14px;
            color: #999;
            line-height: 1.4;
            text-shadow: none;
        }

        /* 年龄选择器 */
        .age-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }

        .age-input {
            background: linear-gradient(145deg, #333, #2a2a2a);
            border: 2px solid #444;
            border-radius: 12px;
            color: #ffffff;
            font-size: 24px;
            font-weight: 600;
            text-align: center;
            width: 80px;
            height: 60px;
            outline: none;
            transition: all 0.3s ease;
        }

        .age-input:focus {
            border-color: #ed7f8c;
            box-shadow: 0 0 0 3px rgba(237, 127, 140, 0.1);
        }

        .age-btn {
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .age-btn:hover {
            transform: scale(1.1);
        }

        /* 颜色选择器 */
        .color-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 20px;
            margin: 20px 0;
            max-width: 600px;
            justify-content: center;
        }

        .color-option {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid #444;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            margin: 0 auto;
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: #ed7f8c;
        }

        .color-option.selected {
            border-color: #ed7f8c;
            box-shadow: 0 0 0 3px rgba(237, 127, 140, 0.3);
        }

        .color-option.selected::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        /* 滑块控制器 */
        .slider-group {
            margin: 30px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .slider-title {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
        }

        .slider-value {
            font-size: 14px;
            color: #ed7f8c;
            font-weight: 600;
        }

        .slider {
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            outline: none;
            cursor: pointer;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        /* 导航按钮 */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-top: 30px;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .btn-nav {
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            min-width: 120px;
        }

        .btn-previous {
            background: rgba(237, 127, 140, 0.1);
            border: 2px solid rgba(237, 127, 140, 0.3);
            color: #ed7f8c;
        }

        .btn-previous:hover {
            background: rgba(237, 127, 140, 0.2);
            transform: translateX(-2px);
        }

        .btn-next {
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            color: white;
        }

        .btn-next:hover {
            transform: translateX(2px);
            box-shadow: 0 5px 20px rgba(237, 127, 140, 0.4);
        }

        .btn-nav:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* 总结页面 */
        .summary-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .summary-section {
            background: linear-gradient(145deg, #333, #2a2a2a);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #444;
        }

        .summary-title {
            font-size: 18px;
            font-weight: 600;
            color: #ed7f8c;
            margin-bottom: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #444;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-size: 14px;
            color: #999;
        }

        .summary-value {
            font-size: 14px;
            color: #ffffff;
            font-weight: 500;
        }

        .btn-create {
            width: 100%;
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            border: none;
            color: white;
            padding: 20px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.3s ease;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
        }

        .btn-create:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(237, 127, 140, 0.4);
        }

        .btn-create:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-create .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        .btn-create.loading .loading-spinner {
            display: inline-block;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* 结果展示模态框 */
        .result-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .result-modal.active {
            display: flex;
        }

        .result-content {
            background: linear-gradient(145deg, #2a2a2a, #1e1e1e);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #333;
            position: relative;
        }

        .result-title {
            font-size: 28px;
            font-weight: 700;
            color: #ed7f8c;
            margin-bottom: 20px;
            text-align: center;
        }

        /* 新的布局样式 */
        .result-layout {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }

        .result-image-section {
            flex: 0 0 350px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-info-section {
            flex: 1;
            text-align: left;
        }

        .result-image {
            width: 100%;
            max-width: 350px;
            height: auto;
            max-height: 450px;
            object-fit: cover;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: block;
        }

        .result-character-name {
            font-size: 24px;
            font-weight: 600;
            color: #ffffff;
            margin: 20px 0 10px;
        }

        .result-description {
            color: #999;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .character-details {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: #ccc;
            font-weight: 500;
            font-size: 14px;
        }

        .detail-value {
            color: #ed7f8c;
            font-weight: 600;
            font-size: 14px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-icon {
            margin-right: 8px;
            font-size: 18px;
        }

        .result-btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .result-btn.primary {
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            color: white;
        }

        .result-btn.secondary {
            background: rgba(237, 127, 140, 0.1);
            border: 2px solid rgba(237, 127, 140, 0.3);
            color: #ed7f8c;
        }

        .result-btn:hover {
            transform: translateY(-2px);
        }

        .result-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #999;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .result-close:hover {
            color: #ed7f8c;
        }

        /* 响应式设计 - 结果模态框 */
        @media (max-width: 768px) {
            .result-content {
                padding: 20px;
                max-width: 95%;
                max-height: 95vh;
            }
            
            .result-layout {
                flex-direction: column;
                gap: 20px;
            }
            
            .result-image-section {
                flex: none;
            }
            
            .result-image {
                max-width: 250px;
                max-height: 300px;
                margin: 0 auto;
            }
            
            .result-info-section {
                text-align: center;
            }
            
            .character-details {
                padding: 15px;
            }
            
            .detail-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .result-title {
                font-size: 24px;
            }
            
            .result-character-name {
                font-size: 20px;
            }
            
            .result-description {
                font-size: 14px;
            }
            
            .result-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .result-btn {
                width: 100%;
                padding: 15px 20px;
            }
        }

        @media (max-width: 480px) {
            .result-content {
                padding: 15px;
                max-width: 98%;
            }
            
            .result-layout {
                gap: 15px;
            }
            
            .result-image {
                max-width: 200px;
                max-height: 250px;
            }
            
            .result-title {
                font-size: 20px;
                margin-bottom: 15px;
            }
            
            .result-character-name {
                font-size: 18px;
                margin: 15px 0 8px;
            }
            
            .result-description {
                font-size: 13px;
                margin-bottom: 20px;
            }
            
            .character-details {
                padding: 12px;
            }
            
            .detail-item {
                padding: 6px 0;
            }
            
            .detail-label, .detail-value {
                font-size: 13px;
            }
        }

        /* 响应式设计 */
        @media (max-width: 1024px) {
            .sidebar {
                margin-left: -280px;
                transition: margin-left 0.3s ease;
            }
            
            .sidebar.active {
                margin-left: 0;
            }
            
            .main-content {
                margin-left: 0;
                width: 100vw;
                padding: 20px;
            }
            
            .options-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
            
            .summary-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        /* 顶部导航栏 - 仅在移动端显示 */
        .top-nav {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(180deg, #2a2a2a 0%, #1e1e1e 100%);
            border-bottom: 1px solid #333;
            z-index: 1001;
            padding: 0 20px;
            align-items: center;
            justify-content: space-between;
        }

        .top-nav-logo {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .top-nav-logo h1 {
            color: #ed7f8c;
            font-size: 20px;
            font-weight: 700;
            margin-right: 10px;
        }

        .top-nav-menu {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .top-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            min-width: 60px;
        }

        .top-nav-item:hover {
            background: rgba(237, 127, 140, 0.1);
        }

        .top-nav-item.active {
            background: rgba(237, 127, 140, 0.15);
        }

        .top-nav-item .icon {
            font-size: 16px;
            color: #ed7f8c;
            margin-bottom: 2px;
        }

        .top-nav-item .text {
            font-size: 10px;
            color: #ffffff;
            font-weight: 500;
        }

        .top-nav-item.active .text {
            color: #ed7f8c;
        }

        .top-nav-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .top-nav-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .top-nav-gems {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #ed7f8c;
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .top-nav {
                display: flex;
            }
            
            .main-content {
                margin-left: 0;
                padding: 80px 15px 15px 15px;
                width: 100vw;
                height: 100vh;
            }
            
            .content-title {
                font-size: 24px;
            }
            
            .step-container {
                padding: 25px;
                flex: 1;
            }
            
            .step-title {
                font-size: 24px;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .color-selector {
                grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
                gap: 10px;
            }
            
            .color-option {
                width: 50px;
                height: 50px;
            }
            
            .age-selector {
                gap: 15px;
            }
            
            .age-input {
                width: 60px;
                height: 50px;
                font-size: 20px;
            }
            
            .age-btn {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .progress-bar {
                gap: 10px;
            }
            
            .progress-step {
                width: 35px;
                height: 35px;
                font-size: 14px;
                font-weight: 700;
            }
            
            .progress-line {
                width: 40px;
            }
            
            .step-navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn-nav {
                width: 100%;
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .summary-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 70px 10px 10px 10px;
                width: 100vw;
                height: 100vh;
            }
            
            .step-container {
                padding: 20px;
                flex: 1;
            }
            
            .option-card {
                padding: 15px;
            }
            
            .option-icon {
                font-size: 36px;
            }
            
            .option-title {
                font-size: 16px;
            }
            
            .option-description {
                font-size: 12px;
            }
            
            .color-selector {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .color-option {
                width: 40px;
                height: 40px;
            }
            

        }


    </style>
</head>
<body>
    <div class="container">
        <!-- 顶部导航栏 - 仅在移动端显示 -->
        <div class="top-nav">
            <div class="top-nav-logo" onclick="window.location.href='./index.html'">
                <h1>Sugar.AI</h1>
            </div>
            <div class="top-nav-menu">
                <div class="top-nav-item" data-nav="explore">
                    <div class="icon">🔍</div>
                    <div class="text">Explore</div>
                </div>
                <div class="top-nav-item active" data-nav="create">
                    <div class="icon">✨</div>
                    <div class="text">Create</div>
                </div>
                <div class="top-nav-item" data-nav="generate">
                    <div class="icon">🎨</div>
                    <div class="text">Generate</div>
                </div>
                <div class="top-nav-item" data-nav="dashboard">
                    <div class="icon">⚙️</div>
                    <div class="text">Dashboard</div>
                </div>
            </div>
            <div class="top-nav-user">
                <div class="top-nav-gems">
                    <span>💎</span>
                    <span id="top-nav-gem-count">1,250</span>
                </div>
                <div class="top-nav-avatar">U</div>
            </div>
        </div>
        
        <!-- 左侧导航栏 -->
        <div class="sidebar">
            <div class="logo" onclick="window.location.href='./index.html'">
                <h1>Sugar.AI</h1>
                <p>AI Girlfriend Platform</p>
            </div>
            
            <nav class="nav-menu">
                <div class="nav-item">
                    <div class="icon">🔍</div>
                    <div class="text">Explore</div>
                </div>
                <div class="nav-item" style="display: none;">
                    <div class="icon">💬</div>
                    <div class="text">Chat</div>
                </div>
                <div class="nav-item active">
                    <div class="icon">✨</div>
                    <div class="text active">Create</div>
                </div>
                <div class="nav-item">
                    <div class="icon">🎨</div>
                    <div class="text">Generate</div>
                </div>
                <div class="nav-item">
                    <div class="icon">⚙️</div>
                    <div class="text">Dashboard</div>
                </div>
            </nav>

            <div class="user-section">
                <!-- 已登录状态 -->
                <div id="user-logged-in" style="display: none;">
                    <div class="user-info">
                        <div class="user-avatar">U</div>
                        <div class="user-details">
                            <h4 id="username">Username</h4>
                            <p id="user-status">Premium Member</p>
                        </div>
                    </div>
                    <div class="gem-balance">
                        <div class="gem-info">
                            <span class="gem-icon">💎</span>
                            <span class="gem-count" id="gem-count">1,250</span>
                        </div>
                        <button style="background: #ed7f8c; border: none; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;" onclick="window.location.href='./purchase.html'">Top Up</button>
                    </div>
                </div>
                
                <!-- 未登录状态 -->
                <div id="user-not-logged-in" style="display: block;">
                    <div class="user-not-logged-content" style="display: block;">
                        <h4 style="text-align: center; color: #ed7f8c; margin-bottom: 8px; font-size: 16px; font-weight: 600;">Welcome to Sugar.AI</h4>
                        <p style="text-align: center; color: #999; font-size: 12px; margin-bottom: 20px; line-height: 1.4;">Sign in to access Create features</p>
                        <button class="login-btn" onclick="window.location.href='./auth.html'" style="width: 100%; background: linear-gradient(135deg, #ed7f8c, #d16570); border: none; color: white; padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">Login / Register</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <div class="content-header">
                <h1 class="content-title">Create Your AI Girlfriend</h1>
                <p class="content-subtitle">Design your perfect companion step by step</p>
            </div>

            <!-- 进度条 -->
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <!-- 动态生成进度步骤 -->
                </div>

            </div>

            <!-- 步骤内容容器 -->
            <div class="step-container" id="stepContainer">
                <!-- 各步骤内容将通过JavaScript动态加载 -->
            </div>
        </div>
    </div>

    <!-- 结果展示模态框 -->
    <div class="result-modal" id="resultModal">
        <div class="result-content">
            <button class="result-close" onclick="closeResult()">×</button>
            <div class="result-title">Character Created Successfully!</div>
            
            <div class="result-layout">
                <!-- 左侧图片区域 -->
                <div class="result-image-section">
                    <img class="result-image" id="resultImage" src="" alt="Generated Character">
                </div>
                
                <!-- 右侧信息区域 -->
                <div class="result-info-section">
                    <div class="result-character-name" id="resultCharacterName"></div>
                    <div class="result-description" id="resultDescription"></div>
                    
                    <!-- 角色详细信息 -->
                    <div class="character-details">
                        <div class="detail-item">
                            <span class="detail-label">Age:</span>
                            <span class="detail-value" id="resultAge"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Style:</span>
                            <span class="detail-value" id="resultStyle"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Ethnicity:</span>
                            <span class="detail-value" id="resultEthnicity"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Hair Color:</span>
                            <span class="detail-value" id="resultHairColor"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Eye Color:</span>
                            <span class="detail-value" id="resultEyeColor"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Body Type:</span>
                            <span class="detail-value" id="resultBodyType"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Outfit:</span>
                            <span class="detail-value" id="resultOutfit"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Background:</span>
                            <span class="detail-value" id="resultBackground"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 底部按钮区域 -->
            <div class="result-actions">
                <button class="result-btn secondary" onclick="createAnother()">
                    <span class="btn-icon">🔄</span>
                    Recreate Character
                </button>
                <button class="result-btn primary" onclick="generateCharacterImage()">
                    <span class="btn-icon">🎨</span>
                    Generate Image
                </button>
                <button class="result-btn primary" onclick="generateCharacterVideo()">
                    <span class="btn-icon">🎬</span>
                    Generate Video
                </button>
            </div>
        </div>
    </div>

    <script>
        // User authentication state management
        let isLoggedIn = false;
        let currentUser = null;

        // Check login status on page load
        function checkLoginStatus() {
            const token = localStorage.getItem('token');
            const userData = localStorage.getItem('userData');
            
            if (token && userData) {
                try {
                    currentUser = JSON.parse(userData);
                    isLoggedIn = true;
                    showLoggedInState();
                } catch (error) {
                    console.error('Error parsing user data:', error);
                    logout();
                }
            } else {
                showNotLoggedInState();
            }
        }

        // Show logged in state
        function showLoggedInState() {
            document.getElementById('user-logged-in').style.display = 'block';
            document.getElementById('user-not-logged-in').style.display = 'none';
            
            if (currentUser) {
                document.getElementById('username').textContent = currentUser.name || currentUser.email || 'User';
                document.getElementById('user-status').textContent = currentUser.membershipType || 'Free Member';
                document.getElementById('gem-count').textContent = currentUser.gemBalance || '0';
            }
        }

        // Show not logged in state
        function showNotLoggedInState() {
            document.getElementById('user-logged-in').style.display = 'none';
            document.getElementById('user-not-logged-in').style.display = 'block';
        }

        // Logout function
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userData');
            currentUser = null;
            isLoggedIn = false;
            showNotLoggedInState();
        }

        // 全局变量
        let currentStep = 1;
        let totalSteps = 7;
        let characterData = {
            style: 'realistic',           // 默认选择第一项：Realistic
            ethnicity: 'asian',           // 默认选择第一项：Asian
            age: 22,
            hairColor: 'black',           // 默认选择第一项：Black
            eyeColor: 'dark_brown',       // 默认选择第一项：Dark Brown
            bodyType: 'petite',           // 默认选择第一项：Petite
            outfit: 'casual',             // 默认选择第一项：Casual
            background: 'home',           // 默认选择第一项：Home
            name: 'Luna'                  // 默认角色名
        };

        // 步骤配置
        const steps = {
            1: {
                title: 'Choose Style',
                subtitle: 'Select your preferred art style',
                type: 'style'
            },
            2: {
                title: 'Choose Ethnicity & Age',
                subtitle: 'Select ethnicity and age for your character',
                type: 'ethnicity'
            },
            3: {
                title: 'Choose Appearance',
                subtitle: 'Select hair color, skin color, and eye color',
                type: 'appearance'
            },
            4: {
                title: 'Choose Body Type',
                subtitle: 'Customize body proportions and fitness level',
                type: 'body'
            },
            5: {
                title: 'Choose Outfit',
                subtitle: 'Select the clothing style and fashion for your character',
                type: 'outfit'
            },
            6: {
                title: 'Choose Background',
                subtitle: 'Select the setting and environment for your character',
                type: 'background'
            },
            7: {
                title: 'Summary',
                subtitle: 'Review your choices and create your AI companion',
                type: 'summary'
            }
        };

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 检查用户登录状态
            checkLoginStatus();
            
            initializeProgress();
            loadStep(1);
        });

        // 初始化进度条
        function initializeProgress() {
            const progressBar = document.getElementById('progressBar');
            progressBar.innerHTML = '';
            
            for (let i = 1; i <= totalSteps; i++) {
                // 创建步骤圆圈
                const step = document.createElement('div');
                step.className = 'progress-step';
                step.id = `step-${i}`;
                step.textContent = i;
                
                if (i === 1) {
                    step.classList.add('active');
                }
                
                progressBar.appendChild(step);
                
                // 添加连接线（除了最后一步）
                if (i < totalSteps) {
                    const line = document.createElement('div');
                    line.className = 'progress-line';
                    line.id = `line-${i}`;
                    progressBar.appendChild(line);
                }
            }
        }

        // 更新进度条
        function updateProgress() {
            for (let i = 1; i <= totalSteps; i++) {
                const step = document.getElementById(`step-${i}`);
                const line = document.getElementById(`line-${i}`);
                
                if (i < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                    if (line) line.classList.add('completed');
                } else if (i === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                    if (line) line.classList.remove('completed');
                }
            }
        }

        // 加载步骤内容
        function loadStep(stepNumber) {
            const stepConfig = steps[stepNumber];
            const container = document.getElementById('stepContainer');
            
            let content = `
                <div class="step-content">
                    <div class="step-title">${stepConfig.title}</div>
                    <div class="step-subtitle">${stepConfig.subtitle}</div>
            `;
            
            switch (stepConfig.type) {
                case 'style':
                    content += getStyleContent();
                    break;
                case 'ethnicity':
                    content += getEthnicityContent();
                    break;
                case 'appearance':
                    content += getAppearanceContent();
                    break;
                case 'body':
                    content += getBodyContent();
                    break;
                case 'outfit':
                    content += getOutfitContent();
                    break;
                case 'background':
                    content += getBackgroundContent();
                    break;
                case 'summary':
                    content += getSummaryContent();
                    break;
            }
            
            content += `
                </div>
                <!-- 导航按钮 -->
                <div class="step-navigation">
                    <button class="btn-nav btn-previous" id="prevBtn" onclick="previousStep()" ${stepNumber === 1 ? 'disabled' : ''}>
                        ← Previous
                    </button>
                    <button class="btn-nav btn-next" id="nextBtn" onclick="nextStep()">
                        Next →
                    </button>
                </div>
            `;
            
            container.innerHTML = content;
            updateProgress();
            updateNavigation();
        }

        // 获取样式选择内容
        function getStyleContent() {
            const styles = [
                { id: 'realistic', image: 'assets/pic_1.jpeg', title: 'Realistic', description: 'Photorealistic human appearance' },
                { id: 'anime', image: 'assets/pic_2.jpeg', title: 'Anime', description: 'Stylized anime/manga appearance' }
            ];
            
            let content = '<div class="options-grid style-grid">';
            styles.forEach(style => {
                const selected = characterData.style === style.id ? 'selected' : '';
                content += `
                    <div class="option-card ${selected}" onclick="selectStyle('${style.id}')">
                        <div class="option-image" style="background-image: url('${style.image}')"></div>
                        <div class="option-info">
                            <div class="option-title">${style.title}</div>
                            <div class="option-description">${style.description}</div>
                        </div>
                    </div>
                `;
            });
            content += '</div>';
            return content;
        }

        // 获取种族和年龄选择内容
        function getEthnicityContent() {
            const ethnicities = [
                { id: 'asian', image: 'assets/ethnicity/asian.jpg', title: 'Asian', description: 'East Asian features' },
                { id: 'caucasian', image: 'assets/ethnicity/caucasian.jpg', title: 'Caucasian', description: 'European features' },
                { id: 'latina', image: 'assets/ethnicity/latina.jpg', title: 'Latina', description: 'Latin American features' },
                { id: 'african', image: 'assets/ethnicity/african.jpg', title: 'African', description: 'African features' },
                { id: 'middle_eastern', image: 'assets/ethnicity/middle_eastern.jpg', title: 'Middle Eastern', description: 'Middle Eastern features' },
                { id: 'mixed', image: 'assets/ethnicity/mixed.jpg', title: 'Mixed', description: 'Mixed ethnicity' }
            ];
            
            let content = '<div class="options-grid icon-grid">';
            ethnicities.forEach(ethnicity => {
                const selected = characterData.ethnicity === ethnicity.id ? 'selected' : '';
                content += `
                    <div class="option-card icon-card ${selected}" onclick="selectEthnicity('${ethnicity.id}')">
                        <div class="option-image" id="ethnicity-image-${ethnicity.id}" style="background-image: url('${ethnicity.image}')"></div>
                        <div class="option-title">${ethnicity.title}</div>
                        <div class="option-description">${ethnicity.description}</div>
                    </div>
                `;
            });
            content += '</div>';
            
            content += `
                <div style="margin-top: 40px;">
                    <h3 style="color: #ed7f8c; margin-bottom: 20px; text-align: center; font-size: 20px;">Age</h3>
                    <div class="age-selector">
                        <button class="age-btn" onclick="changeAge(-1)">-</button>
                        <input type="number" class="age-input" id="ageInput" value="${characterData.age}" min="18" max="40" onchange="updateAge()">
                        <button class="age-btn" onclick="changeAge(1)">+</button>
                    </div>
                </div>
            `;
            
            // 在内容加载后检查图片
            setTimeout(() => {
                ethnicities.forEach(ethnicity => {
                    checkImageLoad(ethnicity.id, ethnicity.image);
                });
            }, 100);
            
            return content;
        }

        // 获取外观选择内容
        function getAppearanceContent() {
            const hairColors = [
                { id: 'black', color: '#1B1B1B', name: 'Black' },
                { id: 'dark_brown', color: '#3B2F2F', name: 'Dark Brown' },
                { id: 'brown', color: '#6B4423', name: 'Brown' },
                { id: 'light_brown', color: '#8B6F47', name: 'Light Brown' },
                { id: 'dirty_blonde', color: '#B89778', name: 'Dirty Blonde' },
                { id: 'blonde', color: '#D4C194', name: 'Blonde' },
                { id: 'strawberry_blonde', color: '#C7956D', name: 'Strawberry Blonde' },
                { id: 'red', color: '#8B3103', name: 'Auburn Red' },
                { id: 'light_red', color: '#B85450', name: 'Light Red' },
                { id: 'gray', color: '#7D7D7D', name: 'Gray' },
                { id: 'silver', color: '#C0C0C0', name: 'Silver' },
                { id: 'white', color: '#F5F5F5', name: 'White' }
            ];
            
            const eyeColors = [
                { id: 'dark_brown', color: '#3E2723', name: 'Dark Brown' },
                { id: 'brown', color: '#6D4C41', name: 'Brown' },
                { id: 'hazel', color: '#8D6E63', name: 'Hazel' },
                { id: 'amber', color: '#D2691E', name: 'Amber' },
                { id: 'green', color: '#4CAF50', name: 'Green' },
                { id: 'blue', color: '#2196F3', name: 'Blue' },
                { id: 'light_blue', color: '#81D4FA', name: 'Light Blue' },
                { id: 'gray', color: '#90A4AE', name: 'Gray' },
                { id: 'violet', color: '#7B1FA2', name: 'Violet' }
            ];
            
            let content = '<div style="max-width: 900px; margin: 0 auto;">';
            
            // 发色
            content += '<div style="margin-bottom: 50px;"><h3 style="color: #ed7f8c; margin-bottom: 25px; text-align: center; font-size: 20px;">Hair Color</h3>';
            content += '<div class="color-selector" style="margin: 0 auto;">';
            hairColors.forEach(color => {
                const selected = characterData.hairColor === color.id ? 'selected' : '';
                content += `
                    <div class="color-option ${selected}" style="background-color: ${color.color}" 
                         onclick="selectHairColor('${color.id}')" title="${color.name}">
                    </div>
                `;
            });
            content += '</div></div>';
            
            // 眼色
            content += '<div><h3 style="color: #ed7f8c; margin-bottom: 25px; text-align: center; font-size: 20px;">Eye Color</h3>';
            content += '<div class="color-selector" style="margin: 0 auto;">';
            eyeColors.forEach(color => {
                const selected = characterData.eyeColor === color.id ? 'selected' : '';
                content += `
                    <div class="color-option ${selected}" style="background-color: ${color.color}" 
                         onclick="selectEyeColor('${color.id}')" title="${color.name}">
                    </div>
                `;
            });
            content += '</div></div>';
            
            content += '</div>';
            return content;
        }

        // 获取身体类型选择内容
        function getBodyContent() {
            const bodyTypes = [
                { id: 'petite', icon: '👩', title: 'Petite', description: 'Small and delicate build' },
                { id: 'slim', icon: '🧘‍♀️', title: 'Slim', description: 'Lean and athletic figure' },
                { id: 'average', icon: '👤', title: 'Average', description: 'Balanced proportions' },
                { id: 'curvy', icon: '💃', title: 'Curvy', description: 'Full hourglass figure' },
                { id: 'voluptuous', icon: '🌹', title: 'Voluptuous', description: 'Generous curves' },
                { id: 'athletic', icon: '🏃‍♀️', title: 'Athletic', description: 'Toned and muscular' },
                { id: 'plus_size', icon: '💕', title: 'Plus Size', description: 'Fuller figure' },
                { id: 'tall_slim', icon: '🗽', title: 'Tall & Slim', description: 'Tall with lean build' }
            ];
            
            let content = '<div class="options-grid icon-grid">';
            bodyTypes.forEach(bodyType => {
                const selected = characterData.bodyType === bodyType.id ? 'selected' : '';
                content += `
                    <div class="option-card icon-card ${selected}" onclick="selectBodyType('${bodyType.id}')">
                        <div class="option-icon">${bodyType.icon}</div>
                        <div class="option-title">${bodyType.title}</div>
                        <div class="option-description">${bodyType.description}</div>
                    </div>
                `;
            });
            content += '</div>';
            return content;
        }

        // 获取穿着选择内容
        function getOutfitContent() {
            const outfits = [
                { id: 'casual', icon: '👕', title: 'Casual', description: 'Comfortable everyday clothing like t-shirts and jeans' },
                { id: 'elegant', icon: '👗', title: 'Elegant', description: 'Sophisticated dresses and formal attire' },
                { id: 'business', icon: '💼', title: 'Business', description: 'Professional office wear and suits' },
                { id: 'sporty', icon: '🏃‍♀️', title: 'Sporty', description: 'Athletic wear and fitness clothing' },
                { id: 'sexy', icon: '🔥', title: 'Sexy', description: 'Alluring and provocative fashion choices' },
                { id: 'vintage', icon: '🎭', title: 'Vintage', description: 'Retro and classic fashion styles' },
                { id: 'gothic', icon: '🖤', title: 'Gothic', description: 'Dark and mysterious gothic fashion' },
                { id: 'cute', icon: '🌸', title: 'Cute', description: 'Adorable and kawaii style clothing' },
                { id: 'punk', icon: '⚡', title: 'Punk', description: 'Rebellious and edgy punk rock style' },
                { id: 'bohemian', icon: '🌿', title: 'Bohemian', description: 'Free-spirited and artistic boho style' },
                { id: 'streetwear', icon: '🛹', title: 'Streetwear', description: 'Urban and trendy street fashion' },
                { id: 'loungewear', icon: '🛋️', title: 'Loungewear', description: 'Comfortable home and relaxation wear' }
            ];
            
            let content = '<div class="options-grid icon-grid">';
            outfits.forEach(outfit => {
                const selected = characterData.outfit === outfit.id ? 'selected' : '';
                content += `
                    <div class="option-card icon-card ${selected}" onclick="selectOutfit('${outfit.id}')">
                        <div class="option-icon">${outfit.icon}</div>
                        <div class="option-title">${outfit.title}</div>
                        <div class="option-description">${outfit.description}</div>
                    </div>
                `;
            });
            content += '</div>';
            return content;
        }

        // 获取背景场景选择内容
        function getBackgroundContent() {
            const backgrounds = [
                { id: 'beach', icon: '🏖️', title: 'Beach', description: 'Sunny beach with ocean waves and palm trees' },
                { id: 'city', icon: '🌆', title: 'City', description: 'Urban cityscape with skyscrapers and lights' },
                { id: 'forest', icon: '🌲', title: 'Forest', description: 'Peaceful forest with trees and nature' },
                { id: 'office', icon: '🏢', title: 'Office', description: 'Professional office environment' },
                { id: 'home', icon: '🏠', title: 'Home', description: 'Cozy home interior with comfortable furniture' },
                { id: 'cafe', icon: '☕', title: 'Cafe', description: 'Charming cafe with coffee and pastries' },
                { id: 'gym', icon: '💪', title: 'Gym', description: 'Modern fitness center with equipment' },
                { id: 'school', icon: '🎓', title: 'School', description: 'Educational campus environment' },
                { id: 'party', icon: '🎉', title: 'Party', description: 'Vibrant party scene with music and lights' },
                { id: 'garden', icon: '🌺', title: 'Garden', description: 'Beautiful garden with flowers and plants' },
                { id: 'mountain', icon: '⛰️', title: 'Mountain', description: 'Scenic mountain landscape with peaks' },
                { id: 'nightclub', icon: '🕺', title: 'Nightclub', description: 'Energetic nightclub with dance floor' }
            ];
            
            let content = '<div class="options-grid icon-grid">';
            backgrounds.forEach(background => {
                const selected = characterData.background === background.id ? 'selected' : '';
                content += `
                    <div class="option-card icon-card ${selected}" onclick="selectBackground('${background.id}')">
                        <div class="option-icon">${background.icon}</div>
                        <div class="option-title">${background.title}</div>
                        <div class="option-description">${background.description}</div>
                    </div>
                `;
            });
            content += '</div>';
            return content;
        }

        // 获取总结内容
        function getSummaryContent() {
            const getDisplayValue = (key, value) => {
                const mappings = {
                    style: { realistic: 'Realistic', anime: 'Anime' },
                    ethnicity: { asian: 'Asian', caucasian: 'Caucasian', latina: 'Latina', african: 'African', middle_eastern: 'Middle Eastern', mixed: 'Mixed' },
                    hairColor: { 
                        black: 'Black', 
                        dark_brown: 'Dark Brown', 
                        brown: 'Brown', 
                        light_brown: 'Light Brown', 
                        dirty_blonde: 'Dirty Blonde', 
                        blonde: 'Blonde', 
                        strawberry_blonde: 'Strawberry Blonde', 
                        red: 'Auburn Red', 
                        light_red: 'Light Red', 
                        gray: 'Gray', 
                        silver: 'Silver', 
                        white: 'White' 
                    },
                    eyeColor: { 
                        dark_brown: 'Dark Brown', 
                        brown: 'Brown', 
                        hazel: 'Hazel', 
                        amber: 'Amber', 
                        green: 'Green', 
                        blue: 'Blue', 
                        light_blue: 'Light Blue', 
                        gray: 'Gray', 
                        violet: 'Violet' 
                    },
                    bodyType: { 
                        petite: 'Petite', 
                        slim: 'Slim', 
                        average: 'Average', 
                        curvy: 'Curvy', 
                        voluptuous: 'Voluptuous', 
                        athletic: 'Athletic', 
                        plus_size: 'Plus Size', 
                        tall_slim: 'Tall & Slim' 
                    },
                    outfit: { casual: 'Casual', elegant: 'Elegant', business: 'Business', sporty: 'Sporty', sexy: 'Sexy', vintage: 'Vintage', gothic: 'Gothic', cute: 'Cute', punk: 'Punk', bohemian: 'Bohemian', streetwear: 'Streetwear', loungewear: 'Loungewear' },
                    background: { beach: 'Beach', city: 'City', forest: 'Forest', office: 'Office', home: 'Home', cafe: 'Cafe', gym: 'Gym', school: 'School', party: 'Party', garden: 'Garden', mountain: 'Mountain', nightclub: 'Nightclub' }
                };
                return mappings[key] && mappings[key][value] ? mappings[key][value] : value;
            };
            
            return `
                <div class="summary-container">
                    <div class="summary-section">
                        <div class="summary-title">Basic Information</div>
                        <div class="summary-item">
                            <span class="summary-label">Style:</span>
                            <span class="summary-value">${getDisplayValue('style', characterData.style)}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Ethnicity:</span>
                            <span class="summary-value">${getDisplayValue('ethnicity', characterData.ethnicity)}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Age:</span>
                            <span class="summary-value">${characterData.age}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Background:</span>
                            <span class="summary-value">${getDisplayValue('background', characterData.background)}</span>
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <div class="summary-title">Appearance</div>
                        <div class="summary-item">
                            <span class="summary-label">Hair Color:</span>
                            <span class="summary-value">${getDisplayValue('hairColor', characterData.hairColor)}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Eye Color:</span>
                            <span class="summary-value">${getDisplayValue('eyeColor', characterData.eyeColor)}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Body Type:</span>
                            <span class="summary-value">${getDisplayValue('bodyType', characterData.bodyType)}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Outfit:</span>
                            <span class="summary-value">${getDisplayValue('outfit', characterData.outfit)}</span>
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <div class="summary-title">Selection Status</div>
                        <div class="summary-item">
                            <span class="summary-label">Style:</span>
                            <span class="summary-value" style="color: ${characterData.style ? '#4CAF50' : '#ed7f8c'}">${characterData.style ? '✓ Selected' : '✗ Required'}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Ethnicity:</span>
                            <span class="summary-value" style="color: ${characterData.ethnicity ? '#4CAF50' : '#ed7f8c'}">${characterData.ethnicity ? '✓ Selected' : '✗ Required'}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Hair Color:</span>
                            <span class="summary-value" style="color: ${characterData.hairColor ? '#4CAF50' : '#999'}">${characterData.hairColor ? '✓ Selected' : 'Optional'}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Eye Color:</span>
                            <span class="summary-value" style="color: ${characterData.eyeColor ? '#4CAF50' : '#999'}">${characterData.eyeColor ? '✓ Selected' : 'Optional'}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Body Type:</span>
                            <span class="summary-value" style="color: ${characterData.bodyType ? '#4CAF50' : '#ed7f8c'}">${characterData.bodyType ? '✓ Selected' : '✗ Required'}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Outfit:</span>
                            <span class="summary-value" style="color: ${characterData.outfit ? '#4CAF50' : '#ed7f8c'}">${characterData.outfit ? '✓ Selected' : '✗ Required'}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Background:</span>
                            <span class="summary-value" style="color: ${characterData.background ? '#4CAF50' : '#ed7f8c'}">${characterData.background ? '✓ Selected' : '✗ Required'}</span>
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <div class="summary-title">Character Name</div>
                        <input type="text" class="age-input" id="characterName" value="${characterData.name}" 
                               placeholder="Enter character name..." onchange="updateCharacterName()" 
                               style="width: 100%; margin-top: 10px;">
                    </div>
                </div>
                
                <button class="btn-create" id="createBtn" onclick="createCharacter()">
                    <div class="loading-spinner"></div>
                    <span class="btn-text">Create Character</span>
                </button>
            `;
        }

        // 选择函数
        function selectStyle(style) {
            characterData.style = style;
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
        }

        function selectEthnicity(ethnicity) {
            characterData.ethnicity = ethnicity;
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
        }

        function selectHairColor(color) {
            characterData.hairColor = color;
            // 只移除发色选择器中的选中状态
            const hairColorContainer = event.target.closest('.color-selector');
            hairColorContainer.querySelectorAll('.color-option').forEach(option => option.classList.remove('selected'));
            event.target.classList.add('selected');
        }



        function selectEyeColor(color) {
            characterData.eyeColor = color;
            // 只移除眼色选择器中的选中状态
            const eyeColorContainer = event.target.closest('.color-selector');
            eyeColorContainer.querySelectorAll('.color-option').forEach(option => option.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        function selectOutfit(outfit) {
            characterData.outfit = outfit;
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
        }

        function selectBackground(background) {
            characterData.background = background;
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
        }

        function selectBodyType(bodyType) {
            characterData.bodyType = bodyType;
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
        }

        // 年龄控制
        function changeAge(delta) {
            const newAge = characterData.age + delta;
            if (newAge >= 18 && newAge <= 40) {
                characterData.age = newAge;
                document.getElementById('ageInput').value = newAge;
            }
        }

        function updateAge() {
            const age = parseInt(document.getElementById('ageInput').value);
            if (age >= 18 && age <= 40) {
                characterData.age = age;
            }
        }



        // 角色名称更新
        function updateCharacterName() {
            characterData.name = document.getElementById('characterName').value;
        }

        // 导航功能
        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                loadStep(currentStep);
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                loadStep(currentStep);
            }
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentStep === 1;
            
            if (currentStep === totalSteps) {
                nextBtn.style.visibility = 'hidden';  // 改为invisible保持占位
            } else {
                nextBtn.style.visibility = 'visible';
            }
        }

        // 创建角色
        function createCharacter() {
            // 所有项目都有默认值，可以直接创建
            // 但仍然进行基本验证确保数据完整性
            if (!characterData.name || characterData.name.trim() === '') {
                characterData.name = 'Luna'; // 如果名字为空，使用默认名字
            }
            
            // 确保所有必填项都有值（理论上不应该为空，因为都有默认值）
            if (!characterData.style) characterData.style = 'realistic';
            if (!characterData.ethnicity) characterData.ethnicity = 'asian';
            if (!characterData.bodyType) characterData.bodyType = 'petite';
            if (!characterData.outfit) characterData.outfit = 'casual';
            if (!characterData.background) characterData.background = 'home';
            if (!characterData.hairColor) characterData.hairColor = 'black';
            if (!characterData.eyeColor) characterData.eyeColor = 'dark_brown';
            
            // 开始加载状态
            startGenerating();
            
            // 模拟AI生成过程（3-5秒）
            const generationTime = 3000 + Math.random() * 2000; // 3-5秒
            
            setTimeout(() => {
                // 生成角色完成
                completeGeneration();
            }, generationTime);
        }

        // 开始生成状态
        function startGenerating() {
            const btn = document.getElementById('createBtn');
            const btnText = btn.querySelector('.btn-text');
            
            btn.disabled = true;
            btn.classList.add('loading');
            btnText.textContent = 'Generating your character...';
        }

        // 完成生成
        function completeGeneration() {
            const btn = document.getElementById('createBtn');
            const btnText = btn.querySelector('.btn-text');
            
            // 重置按钮状态
            btn.disabled = false;
            btn.classList.remove('loading');
            btnText.textContent = 'Create Character';
            
            // 生成随机ID
            const characterId = 'character_' + Date.now();
            
            // 保存角色数据
            const fullCharacterData = {
                id: characterId,
                ...characterData,
                createdAt: new Date().toISOString()
            };
            
            // 保存到本地存储
            localStorage.setItem('newCharacter', JSON.stringify(fullCharacterData));
            
            // 生成结果图片和描述
            const resultData = generateCharacterResult();
            
            // 显示结果模态框
            showResult(resultData);
        }

        // 生成角色结果（随机选择图片和生成描述）
        function generateCharacterResult() {
            // 可用的角色图片库（使用正确的文件扩展名）
            const characterImages = [
                'assets/pic_1.jpeg',
                'assets/pic_2.jpeg', 
                'assets/pic_3.jpg',
                'assets/pic_4.jpg',
                'assets/pic_5.jpg',
                'assets/pic_6.jpg',
                'assets/pic_7.jpeg',
                'assets/pic_8.jpg',
                'assets/pic_9.jpg',
                'assets/pic_10.jpeg'
            ];
            
            // 随机选择一张图片
            const randomImage = characterImages[Math.floor(Math.random() * characterImages.length)];
            
            // 生成角色描述
            const outfitMap = {
                'casual': 'casually dressed',
                'elegant': 'elegantly dressed',
                'business': 'professionally dressed',
                'sporty': 'sporty and athletic',
                'sexy': 'alluring and sexy',
                'vintage': 'vintage styled',
                'gothic': 'gothic styled',
                'cute': 'adorably cute',
                'punk': 'punk rock styled',
                'bohemian': 'bohemian styled',
                'streetwear': 'street fashion styled',
                'loungewear': 'comfortably dressed'
            };
            
            const backgroundMap = {
                'beach': 'at the beach',
                'city': 'in the city',
                'forest': 'in the forest',
                'office': 'at the office',
                'home': 'at home',
                'cafe': 'at a cafe',
                'gym': 'at the gym',
                'school': 'at school',
                'party': 'at a party',
                'garden': 'in the garden',
                'mountain': 'in the mountains',
                'nightclub': 'at a nightclub'
            };
            
            const styleText = characterData.style === 'realistic' ? 'realistic' : 'anime-style';
            const outfitText = outfitMap[characterData.outfit] || characterData.outfit;
            const backgroundText = backgroundMap[characterData.background] || characterData.background;
            
            const description = `Meet ${characterData.name}, your new ${styleText} AI companion! She's a ${characterData.age}-year-old character who is ${outfitText} and can be found ${backgroundText}. Her ${characterData.hairColor} hair and ${characterData.eyeColor} eyes perfectly complement her ${characterData.bodyType} figure.`;
            
            return {
                image: randomImage,
                name: characterData.name,
                description: description
            };
        }

        // 显示结果模态框
        function showResult(resultData) {
            const modal = document.getElementById('resultModal');
            const resultImage = document.getElementById('resultImage');
            const resultName = document.getElementById('resultCharacterName');
            const resultDescription = document.getElementById('resultDescription');
            
            // 设置图片加载失败的回退
            resultImage.onerror = function() {
                console.warn('Failed to load image:', resultData.image);
                // 尝试加载另一张图片
                const fallbackImages = [
                    'assets/pic_1.jpeg',
                    'assets/pic_2.jpeg',
                    'assets/pic_7.jpeg',
                    'assets/pic_10.jpeg'
                ];
                const randomFallback = fallbackImages[Math.floor(Math.random() * fallbackImages.length)];
                if (this.src !== randomFallback) {
                    this.src = randomFallback;
                } else {
                    // 如果连备用图片都加载失败，显示占位符
                    this.style.display = 'none';
                    this.parentElement.innerHTML += '<div style="width: 100%; max-width: 300px; height: 300px; background: linear-gradient(135deg, #333, #555); border-radius: 16px; display: flex; align-items: center; justify-content: center; color: #ed7f8c; font-size: 48px; margin: 15px auto;">👤</div>';
                }
            };
            
            resultImage.src = resultData.image;
            resultName.textContent = resultData.name;
            resultDescription.textContent = resultData.description;
            
            // 填充详细信息
            fillCharacterDetails();
            
            modal.classList.add('active');
        }

        // 填充角色详细信息
        function fillCharacterDetails() {
            const styleMap = { realistic: 'Realistic', anime: 'Anime' };
            const ethnicityMap = { asian: 'Asian', caucasian: 'Caucasian', african: 'African', latina: 'Latina', middle_eastern: 'Middle Eastern', mixed: 'Mixed' };
            const hairColorMap = { black: 'Black', brown: 'Brown', blonde: 'Blonde', red: 'Red', gray: 'Gray', white: 'White' };
            const eyeColorMap = { dark_brown: 'Dark Brown', light_brown: 'Light Brown', blue: 'Blue', green: 'Green', gray: 'Gray', hazel: 'Hazel' };
            const bodyTypeMap = { petite: 'Petite', slim: 'Slim', athletic: 'Athletic', curvy: 'Curvy', plus_size: 'Plus Size' };
            const outfitMap = { casual: 'Casual', elegant: 'Elegant', business: 'Business', sporty: 'Sporty', sexy: 'Sexy', vintage: 'Vintage', gothic: 'Gothic', cute: 'Cute', punk: 'Punk', bohemian: 'Bohemian', streetwear: 'Streetwear', loungewear: 'Loungewear' };
            const backgroundMap = { beach: 'Beach', city: 'City', forest: 'Forest', office: 'Office', home: 'Home', cafe: 'Cafe', gym: 'Gym', school: 'School', party: 'Party', garden: 'Garden', mountain: 'Mountain', nightclub: 'Nightclub' };
            
            document.getElementById('resultAge').textContent = characterData.age;
            document.getElementById('resultStyle').textContent = styleMap[characterData.style] || characterData.style;
            document.getElementById('resultEthnicity').textContent = ethnicityMap[characterData.ethnicity] || characterData.ethnicity;
            document.getElementById('resultHairColor').textContent = hairColorMap[characterData.hairColor] || characterData.hairColor;
            document.getElementById('resultEyeColor').textContent = eyeColorMap[characterData.eyeColor] || characterData.eyeColor;
            document.getElementById('resultBodyType').textContent = bodyTypeMap[characterData.bodyType] || characterData.bodyType;
            document.getElementById('resultOutfit').textContent = outfitMap[characterData.outfit] || characterData.outfit;
            document.getElementById('resultBackground').textContent = backgroundMap[characterData.background] || characterData.background;
        }

        // 关闭结果模态框
        function closeResult() {
            const modal = document.getElementById('resultModal');
            modal.classList.remove('active');
        }

        // 生成角色图片
        function generateCharacterImage() {
            closeResult();
            // 获取当前显示的角色图片
            const resultImage = document.getElementById('resultImage');
            const imageUrl = resultImage.src;
            
            // 创建包含图片URL的角色数据
            const characterDataWithImage = {
                ...characterData,
                image: imageUrl
            };
            
            // 跳转到生成页面，并传递角色数据
            const characterParams = encodeURIComponent(JSON.stringify(characterDataWithImage));
            window.location.href = `generate.html?character=${characterParams}&mode=image`;
        }

        // 生成角色视频
        function generateCharacterVideo() {
            closeResult();
            // 获取当前显示的角色图片
            const resultImage = document.getElementById('resultImage');
            const imageUrl = resultImage.src;
            
            // 创建包含图片URL的角色数据
            const characterDataWithImage = {
                ...characterData,
                image: imageUrl
            };
            
            // 跳转到生成页面，并传递角色数据
            const characterParams = encodeURIComponent(JSON.stringify(characterDataWithImage));
            window.location.href = `generate.html?character=${characterParams}&mode=video`;
        }

        // 创建另一个角色
        function createAnother() {
            closeResult();
            // 重置角色数据（使用默认值）
            characterData = {
                style: 'realistic',           // 默认选择第一项：Realistic
                ethnicity: 'asian',           // 默认选择第一项：Asian
                age: 22,
                hairColor: 'black',           // 默认选择第一项：Black
                eyeColor: 'dark_brown',       // 默认选择第一项：Dark Brown
                bodyType: 'petite',           // 默认选择第一项：Petite
                outfit: 'casual',             // 默认选择第一项：Casual
                background: 'home',           // 默认选择第一项：Home
                name: 'Luna'                  // 默认角色名
            };
            // 回到第一步
            currentStep = 1;
            loadStep(1);
        }



        // 检查图片是否能正确加载
        function checkImageLoad(ethnicityId, imageUrl) {
            const img = new Image();
            const imageElement = document.getElementById(`ethnicity-image-${ethnicityId}`);
            
            img.onload = function() {
                // 图片加载成功，保持原有样式
                if (imageElement) {
                    imageElement.classList.remove('error');
                }
            };
            
            img.onerror = function() {
                // 图片加载失败，添加错误样式
                if (imageElement) {
                    imageElement.classList.add('error');
                    imageElement.style.backgroundImage = 'none';
                    console.warn(`Failed to load ethnicity image: ${imageUrl}`);
                }
            };
            
            img.src = imageUrl;
        }

        // 导航点击事件处理函数
        function handleNavigation(navType) {
            if (navType === 'explore') {
                    window.location.href = './index.html';
            } else if (navType === 'chat') {
                alert('Chat feature is temporarily unavailable. Please try other features!');
            } else if (navType === 'dashboard') {
                    window.location.href = './dashboard.html';
            } else if (navType === 'create') {
                    // 当前页面
                    return;
            } else if (navType === 'generate') {
                    window.location.href = './generate.html';
            }
        }

        // 左侧导航栏点击事件
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const text = this.querySelector('.text').textContent.toLowerCase();
                handleNavigation(text);
            });
        });
        
        // 顶部导航栏点击事件
        document.querySelectorAll('.top-nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const navType = this.getAttribute('data-nav');
                
                // Remove active state from other top nav items
                document.querySelectorAll('.top-nav-item').forEach(nav => {
                    nav.classList.remove('active');
                });
                
                // Add active state to current item
                this.classList.add('active');
                
                // Handle navigation
                handleNavigation(navType);
            });
        });
    </script>
</body>
</html> 