<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Character - Sugar.AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #212121 0%, #1a1a1a 100%);
            color: #ffffff;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* 左侧导航栏 */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #2a2a2a 0%, #1e1e1e 100%);
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            border-right: 1px solid #333;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
        }

        .logo {
            padding: 30px 25px;
            text-align: center;
            border-bottom: 1px solid #333;
            cursor: pointer;
        }

        .logo h1 {
            color: #ed7f8c;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .logo p {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
            letter-spacing: 1px;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 18px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            position: relative;
        }

        .nav-item:hover {
            background: linear-gradient(90deg, rgba(237, 127, 140, 0.1) 0%, transparent 100%);
            border-left-color: #ed7f8c;
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(237, 127, 140, 0.15) 0%, transparent 100%);
            border-left-color: #ed7f8c;
        }

        .nav-item .icon {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            color: #ed7f8c;
            font-size: 20px;
        }

        .nav-item .text {
            font-size: 16px;
            font-weight: 500;
            color: #ffffff;
        }

        .nav-item .text.active {
            color: #ed7f8c;
        }

        /* 用户信息区域 */
        .user-section {
            position: absolute;
            bottom: 20px;
            left: 25px;
            right: 25px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(237, 127, 140, 0.1) 0%, rgba(237, 127, 140, 0.05) 100%);
            border-radius: 12px;
            border: 1px solid rgba(237, 127, 140, 0.2);
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .user-details h4 {
            color: #ffffff;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .user-details p {
            color: #999;
            font-size: 12px;
        }

        .gem-balance {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .gem-info {
            display: flex;
            align-items: center;
        }

        .gem-icon {
            color: #ed7f8c;
            margin-right: 6px;
        }

        .gem-count {
            color: #ed7f8c;
            font-weight: bold;
        }

        /* 主内容区域 */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: calc(100vw - 280px);
            height: 100vh;
            overflow-y: auto;
        }

        .content-header {
            margin-bottom: 30px;
            text-align: center;
            width: 100%;
            max-width: 800px;
        }

        .content-title {
            font-size: 32px;
            font-weight: 700;
            color: #ed7f8c;
            margin-bottom: 10px;
        }

        .content-subtitle {
            font-size: 16px;
            color: #999;
            margin-bottom: 30px;
        }

        /* 进度条 */
        .progress-container {
            width: 100%;
            max-width: 800px;
            margin-bottom: 30px;
        }

        .progress-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .progress-step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #333;
            border: 2px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .progress-step.active {
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            border-color: #ed7f8c;
            color: white;
        }

        .progress-step.completed {
            background: #ed7f8c;
            border-color: #ed7f8c;
            color: white;
        }

        .progress-line {
            width: 60px;
            height: 2px;
            background: #333;
            transition: all 0.3s ease;
        }

        .progress-line.completed {
            background: #ed7f8c;
        }

        /* 步骤内容 */
        .step-container {
            width: 100%;
            background: linear-gradient(145deg, #2a2a2a, #1e1e1e);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid #333;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
        }

        .step-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .step-title {
            font-size: 28px;
            font-weight: 700;
            color: #ed7f8c;
            margin-bottom: 15px;
            text-align: center;
        }

        .step-subtitle {
            font-size: 16px;
            color: #999;
            margin-bottom: 40px;
            text-align: center;
        }

        /* 选择项网格 */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            flex: 1;
        }

        /* Style步骤的网格 - 居中显示 */
        .options-grid.style-grid {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        /* 图标类型的网格 */
        .options-grid.icon-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .option-card {
            background: linear-gradient(145deg, #333, #2a2a2a);
            border: 2px solid #444;
            border-radius: 20px;
            padding: 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            aspect-ratio: 3/4;
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }

        .option-image {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-color: #555;
            position: relative;
        }

        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(237, 127, 140, 0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .option-card:hover::before {
            opacity: 1;
        }

        .option-card:hover {
            border-color: #ed7f8c;
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(237, 127, 140, 0.3);
        }

        .option-card.selected {
            border-color: #ed7f8c;
            box-shadow: 0 15px 40px rgba(237, 127, 140, 0.3);
        }

        .option-card.selected::after {
            content: '✓';
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: #ed7f8c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: bold;
            z-index: 3;
        }

        .option-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.3) 30%, rgba(0, 0, 0, 0.8) 100%);
            z-index: 2;
        }

        .option-title {
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .option-description {
            font-size: 14px;
            color: #ccc;
            line-height: 1.4;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* 图标类型的选项卡 */
        .option-card.icon-card {
            aspect-ratio: auto;
            padding: 25px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .option-card.icon-card .option-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        /* 人种图片样式 */
        .option-card.icon-card .option-image {
            width: 80px;
            height: 80px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 50%;
            margin-bottom: 15px;
            border: 3px solid #444;
            transition: all 0.3s ease;
            background-color: #333;
            position: relative;
        }

        .option-card.icon-card.selected .option-image {
            border-color: #ed7f8c;
        }

        /* 图片加载失败时的回退样式 */
        .option-card.icon-card .option-image.error {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #999;
        }

        .option-card.icon-card .option-image.error::before {
            content: '📷';
        }

        .option-card.icon-card .option-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
            text-shadow: none;
        }

        .option-card.icon-card .option-description {
            font-size: 14px;
            color: #999;
            line-height: 1.4;
            text-shadow: none;
        }

        /* 年龄选择器 */
        .age-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }

        .age-input {
            background: linear-gradient(145deg, #333, #2a2a2a);
            border: 2px solid #444;
            border-radius: 12px;
            color: #ffffff;
            font-size: 24px;
            font-weight: 600;
            text-align: center;
            width: 80px;
            height: 60px;
            outline: none;
            transition: all 0.3s ease;
        }

        .age-input:focus {
            border-color: #ed7f8c;
            box-shadow: 0 0 0 3px rgba(237, 127, 140, 0.1);
        }

        .age-btn {
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .age-btn:hover {
            transform: scale(1.1);
        }

        /* 颜色选择器 */
        .color-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 20px;
            margin: 20px 0;
            max-width: 600px;
            justify-content: center;
        }

        .color-option {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid #444;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            margin: 0 auto;
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: #ed7f8c;
        }

        .color-option.selected {
            border-color: #ed7f8c;
            box-shadow: 0 0 0 3px rgba(237, 127, 140, 0.3);
        }

        .color-option.selected::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        /* 滑块控制器 */
        .slider-group {
            margin: 30px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .slider-title {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
        }

        .slider-value {
            font-size: 14px;
            color: #ed7f8c;
            font-weight: 600;
        }

        .slider {
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            outline: none;
            cursor: pointer;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        /* 导航按钮 */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-top: 30px;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .btn-nav {
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            min-width: 120px;
        }

        .btn-previous {
            background: rgba(237, 127, 140, 0.1);
            border: 2px solid rgba(237, 127, 140, 0.3);
            color: #ed7f8c;
        }

        .btn-previous:hover {
            background: rgba(237, 127, 140, 0.2);
            transform: translateX(-2px);
        }

        .btn-next {
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            color: white;
        }

        .btn-next:hover {
            transform: translateX(2px);
            box-shadow: 0 5px 20px rgba(237, 127, 140, 0.4);
        }

        .btn-nav:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* 总结页面 */
        .summary-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        .summary-section {
            background: linear-gradient(145deg, #333, #2a2a2a);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #444;
        }

        .summary-title {
            font-size: 18px;
            font-weight: 600;
            color: #ed7f8c;
            margin-bottom: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #444;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-size: 14px;
            color: #999;
        }

        .summary-value {
            font-size: 14px;
            color: #ffffff;
            font-weight: 500;
        }

        .btn-create {
            width: 100%;
            background: linear-gradient(135deg, #ed7f8c, #d16570);
            border: none;
            color: white;
            padding: 20px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .btn-create:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(237, 127, 140, 0.4);
        }

        /* 响应式设计 */
        @media (max-width: 1024px) {
            .sidebar {
                margin-left: -280px;
                transition: margin-left 0.3s ease;
            }
            
            .sidebar.active {
                margin-left: 0;
            }
            
            .main-content {
                margin-left: 0;
                width: 100vw;
                padding: 20px;
            }
            
            .options-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
            
            .summary-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                margin-left: -100%;
            }
            
            .main-content {
                padding: 15px;
                width: 100vw;
                height: 100vh;
            }
            
            .content-title {
                font-size: 24px;
            }
            
            .step-container {
                padding: 25px;
                flex: 1;
            }
            
            .step-title {
                font-size: 24px;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .color-selector {
                grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
                gap: 10px;
            }
            
            .color-option {
                width: 50px;
                height: 50px;
            }
            
            .age-selector {
                gap: 15px;
            }
            
            .age-input {
                width: 60px;
                height: 50px;
                font-size: 20px;
            }
            
            .age-btn {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .progress-bar {
                gap: 10px;
            }
            
            .progress-step {
                width: 25px;
                height: 25px;
                font-size: 12px;
            }
            
            .progress-line {
                width: 40px;
            }
            
            .step-navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn-nav {
                width: 100%;
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .summary-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 10px;
                width: 100vw;
                height: 100vh;
            }
            
            .step-container {
                padding: 20px;
                flex: 1;
            }
            
            .option-card {
                padding: 15px;
            }
            
            .option-icon {
                font-size: 36px;
            }
            
            .option-title {
                font-size: 16px;
            }
            
            .option-description {
                font-size: 12px;
            }
            
            .color-selector {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .color-option {
                width: 40px;
                height: 40px;
            }
            

        }


    </style>
</head>
<body>
    <div class="container">
        <!-- 左侧导航栏 -->
        <div class="sidebar">
            <div class="logo" onclick="window.location.href='./index.html'">
                <h1>Sugar.AI</h1>
                <p>AI Girlfriend Platform</p>
            </div>
            
            <nav class="nav-menu">
                <div class="nav-item">
                    <div class="icon">🔍</div>
                    <div class="text">Explore</div>
                </div>
                <div class="nav-item">
                    <div class="icon">💬</div>
                    <div class="text">Chat</div>
                </div>
                <div class="nav-item active">
                    <div class="icon">✨</div>
                    <div class="text active">Create</div>
                </div>
                <div class="nav-item">
                    <div class="icon">🎨</div>
                    <div class="text">Generate</div>
                </div>
                <div class="nav-item">
                    <div class="icon">⚙️</div>
                    <div class="text">Dashboard</div>
                </div>
            </nav>

            <div class="user-section">
                <!-- 已登录状态 -->
                <div id="user-logged-in" style="display: none;">
                    <div class="user-info">
                        <div class="user-avatar">U</div>
                        <div class="user-details">
                            <h4 id="username">Username</h4>
                            <p id="user-status">Premium Member</p>
                        </div>
                    </div>
                    <div class="gem-balance">
                        <div class="gem-info">
                            <span class="gem-icon">💎</span>
                            <span class="gem-count" id="gem-count">1,250</span>
                        </div>
                        <button style="background: #ed7f8c; border: none; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;" onclick="window.location.href='./purchase.html'">Top Up</button>
                    </div>
                </div>
                
                <!-- 未登录状态 -->
                <div id="user-not-logged-in" style="display: block;">
                    <div class="user-not-logged-content" style="display: block;">
                        <h4 style="text-align: center; color: #ed7f8c; margin-bottom: 8px; font-size: 16px; font-weight: 600;">Welcome to Sugar.AI</h4>
                        <p style="text-align: center; color: #999; font-size: 12px; margin-bottom: 20px; line-height: 1.4;">Sign in to access Create features</p>
                        <button class="login-btn" onclick="window.location.href='./auth.html'" style="width: 100%; background: linear-gradient(135deg, #ed7f8c, #d16570); border: none; color: white; padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">Login / Register</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <div class="content-header">
                <h1 class="content-title">Create Your AI Girlfriend</h1>
                <p class="content-subtitle">Design your perfect companion step by step</p>
            </div>

            <!-- 进度条 -->
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <!-- 动态生成进度步骤 -->
                </div>

            </div>

            <!-- 步骤内容容器 -->
            <div class="step-container" id="stepContainer">
                <!-- 各步骤内容将通过JavaScript动态加载 -->
            </div>
        </div>
    </div>

    <script>
        // User authentication state management
        let isLoggedIn = false;
        let currentUser = null;

        // Check login status on page load
        function checkLoginStatus() {
            const token = localStorage.getItem('token');
            const userData = localStorage.getItem('userData');
            
            if (token && userData) {
                try {
                    currentUser = JSON.parse(userData);
                    isLoggedIn = true;
                    showLoggedInState();
                } catch (error) {
                    console.error('Error parsing user data:', error);
                    logout();
                }
            } else {
                showNotLoggedInState();
            }
        }

        // Show logged in state
        function showLoggedInState() {
            document.getElementById('user-logged-in').style.display = 'block';
            document.getElementById('user-not-logged-in').style.display = 'none';
            
            if (currentUser) {
                document.getElementById('username').textContent = currentUser.name || currentUser.email || 'User';
                document.getElementById('user-status').textContent = currentUser.membershipType || 'Free Member';
                document.getElementById('gem-count').textContent = currentUser.gemBalance || '0';
            }
        }

        // Show not logged in state
        function showNotLoggedInState() {
            document.getElementById('user-logged-in').style.display = 'none';
            document.getElementById('user-not-logged-in').style.display = 'block';
        }

        // Logout function
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userData');
            currentUser = null;
            isLoggedIn = false;
            showNotLoggedInState();
        }

        // 全局变量
        let currentStep = 1;
        let totalSteps = 7;
        let characterData = {
            style: '',
            ethnicity: '',
            age: 22,
            hairColor: '',
            eyeColor: '',
            bodyType: '',
            personality: '',
            relationship: '',
            name: ''
        };

        // 步骤配置
        const steps = {
            1: {
                title: 'Choose Style',
                subtitle: 'Select your preferred art style',
                type: 'style'
            },
            2: {
                title: 'Choose Ethnicity & Age',
                subtitle: 'Select ethnicity and age for your character',
                type: 'ethnicity'
            },
            3: {
                title: 'Choose Appearance',
                subtitle: 'Select hair color, skin color, and eye color',
                type: 'appearance'
            },
            4: {
                title: 'Choose Body Type',
                subtitle: 'Customize body proportions and fitness level',
                type: 'body'
            },
            5: {
                title: 'Choose Personality',
                subtitle: 'Select the personality that matches your ideal companion',
                type: 'personality'
            },
            6: {
                title: 'Choose Relationship',
                subtitle: 'Define your relationship with your AI companion',
                type: 'relationship'
            },
            7: {
                title: 'Summary',
                subtitle: 'Review your choices and create your AI companion',
                type: 'summary'
            }
        };

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 检查用户登录状态
            checkLoginStatus();
            
            initializeProgress();
            loadStep(1);
        });

        // 初始化进度条
        function initializeProgress() {
            const progressBar = document.getElementById('progressBar');
            progressBar.innerHTML = '';
            
            for (let i = 1; i <= totalSteps; i++) {
                // 创建步骤圆圈
                const step = document.createElement('div');
                step.className = 'progress-step';
                step.id = `step-${i}`;
                step.textContent = i;
                
                if (i === 1) {
                    step.classList.add('active');
                }
                
                progressBar.appendChild(step);
                
                // 添加连接线（除了最后一步）
                if (i < totalSteps) {
                    const line = document.createElement('div');
                    line.className = 'progress-line';
                    line.id = `line-${i}`;
                    progressBar.appendChild(line);
                }
            }
        }

        // 更新进度条
        function updateProgress() {
            for (let i = 1; i <= totalSteps; i++) {
                const step = document.getElementById(`step-${i}`);
                const line = document.getElementById(`line-${i}`);
                
                if (i < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                    if (line) line.classList.add('completed');
                } else if (i === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                    if (line) line.classList.remove('completed');
                }
            }
        }

        // 加载步骤内容
        function loadStep(stepNumber) {
            const stepConfig = steps[stepNumber];
            const container = document.getElementById('stepContainer');
            
            let content = `
                <div class="step-content">
                    <div class="step-title">${stepConfig.title}</div>
                    <div class="step-subtitle">${stepConfig.subtitle}</div>
            `;
            
            switch (stepConfig.type) {
                case 'style':
                    content += getStyleContent();
                    break;
                case 'ethnicity':
                    content += getEthnicityContent();
                    break;
                case 'appearance':
                    content += getAppearanceContent();
                    break;
                case 'body':
                    content += getBodyContent();
                    break;
                case 'personality':
                    content += getPersonalityContent();
                    break;
                case 'relationship':
                    content += getRelationshipContent();
                    break;
                case 'summary':
                    content += getSummaryContent();
                    break;
            }
            
            content += `
                </div>
                <!-- 导航按钮 -->
                <div class="step-navigation">
                    <button class="btn-nav btn-previous" id="prevBtn" onclick="previousStep()" ${stepNumber === 1 ? 'disabled' : ''}>
                        ← Previous
                    </button>
                    <button class="btn-nav btn-next" id="nextBtn" onclick="nextStep()">
                        Next →
                    </button>
                </div>
            `;
            
            container.innerHTML = content;
            updateProgress();
            updateNavigation();
        }

        // 获取样式选择内容
        function getStyleContent() {
            const styles = [
                { id: 'realistic', image: 'assets/pic_1.jpeg', title: 'Realistic', description: 'Photorealistic human appearance' },
                { id: 'anime', image: 'assets/pic_2.jpeg', title: 'Anime', description: 'Stylized anime/manga appearance' }
            ];
            
            let content = '<div class="options-grid style-grid">';
            styles.forEach(style => {
                const selected = characterData.style === style.id ? 'selected' : '';
                content += `
                    <div class="option-card ${selected}" onclick="selectStyle('${style.id}')">
                        <div class="option-image" style="background-image: url('${style.image}')"></div>
                        <div class="option-info">
                            <div class="option-title">${style.title}</div>
                            <div class="option-description">${style.description}</div>
                        </div>
                    </div>
                `;
            });
            content += '</div>';
            return content;
        }

        // 获取种族和年龄选择内容
        function getEthnicityContent() {
            const ethnicities = [
                { id: 'asian', image: 'assets/ethnicity/asian.jpg', title: 'Asian', description: 'East Asian features' },
                { id: 'caucasian', image: 'assets/ethnicity/caucasian.jpg', title: 'Caucasian', description: 'European features' },
                { id: 'latina', image: 'assets/ethnicity/latina.jpg', title: 'Latina', description: 'Latin American features' },
                { id: 'african', image: 'assets/ethnicity/african.jpg', title: 'African', description: 'African features' },
                { id: 'middle_eastern', image: 'assets/ethnicity/middle_eastern.jpg', title: 'Middle Eastern', description: 'Middle Eastern features' },
                { id: 'mixed', image: 'assets/ethnicity/mixed.jpg', title: 'Mixed', description: 'Mixed ethnicity' }
            ];
            
            let content = '<div class="options-grid icon-grid">';
            ethnicities.forEach(ethnicity => {
                const selected = characterData.ethnicity === ethnicity.id ? 'selected' : '';
                content += `
                    <div class="option-card icon-card ${selected}" onclick="selectEthnicity('${ethnicity.id}')">
                        <div class="option-image" id="ethnicity-image-${ethnicity.id}" style="background-image: url('${ethnicity.image}')"></div>
                        <div class="option-title">${ethnicity.title}</div>
                        <div class="option-description">${ethnicity.description}</div>
                    </div>
                `;
            });
            content += '</div>';
            
            content += `
                <div style="margin-top: 40px;">
                    <h3 style="color: #ed7f8c; margin-bottom: 20px; text-align: center; font-size: 20px;">Age</h3>
                    <div class="age-selector">
                        <button class="age-btn" onclick="changeAge(-1)">-</button>
                        <input type="number" class="age-input" id="ageInput" value="${characterData.age}" min="18" max="40" onchange="updateAge()">
                        <button class="age-btn" onclick="changeAge(1)">+</button>
                    </div>
                </div>
            `;
            
            // 在内容加载后检查图片
            setTimeout(() => {
                ethnicities.forEach(ethnicity => {
                    checkImageLoad(ethnicity.id, ethnicity.image);
                });
            }, 100);
            
            return content;
        }

        // 获取外观选择内容
        function getAppearanceContent() {
            const hairColors = [
                { id: 'black', color: '#1B1B1B', name: 'Black' },
                { id: 'dark_brown', color: '#3B2F2F', name: 'Dark Brown' },
                { id: 'brown', color: '#6B4423', name: 'Brown' },
                { id: 'light_brown', color: '#8B6F47', name: 'Light Brown' },
                { id: 'dirty_blonde', color: '#B89778', name: 'Dirty Blonde' },
                { id: 'blonde', color: '#D4C194', name: 'Blonde' },
                { id: 'strawberry_blonde', color: '#C7956D', name: 'Strawberry Blonde' },
                { id: 'red', color: '#8B3103', name: 'Auburn Red' },
                { id: 'light_red', color: '#B85450', name: 'Light Red' },
                { id: 'gray', color: '#7D7D7D', name: 'Gray' },
                { id: 'silver', color: '#C0C0C0', name: 'Silver' },
                { id: 'white', color: '#F5F5F5', name: 'White' }
            ];
            
            const eyeColors = [
                { id: 'dark_brown', color: '#3E2723', name: 'Dark Brown' },
                { id: 'brown', color: '#6D4C41', name: 'Brown' },
                { id: 'hazel', color: '#8D6E63', name: 'Hazel' },
                { id: 'amber', color: '#D2691E', name: 'Amber' },
                { id: 'green', color: '#4CAF50', name: 'Green' },
                { id: 'blue', color: '#2196F3', name: 'Blue' },
                { id: 'light_blue', color: '#81D4FA', name: 'Light Blue' },
                { id: 'gray', color: '#90A4AE', name: 'Gray' },
                { id: 'violet', color: '#7B1FA2', name: 'Violet' }
            ];
            
            let content = '<div style="max-width: 900px; margin: 0 auto;">';
            
            // 发色
            content += '<div style="margin-bottom: 50px;"><h3 style="color: #ed7f8c; margin-bottom: 25px; text-align: center; font-size: 20px;">Hair Color</h3>';
            content += '<div class="color-selector" style="margin: 0 auto;">';
            hairColors.forEach(color => {
                const selected = characterData.hairColor === color.id ? 'selected' : '';
                content += `
                    <div class="color-option ${selected}" style="background-color: ${color.color}" 
                         onclick="selectHairColor('${color.id}')" title="${color.name}">
                    </div>
                `;
            });
            content += '</div></div>';
            
            // 眼色
            content += '<div><h3 style="color: #ed7f8c; margin-bottom: 25px; text-align: center; font-size: 20px;">Eye Color</h3>';
            content += '<div class="color-selector" style="margin: 0 auto;">';
            eyeColors.forEach(color => {
                const selected = characterData.eyeColor === color.id ? 'selected' : '';
                content += `
                    <div class="color-option ${selected}" style="background-color: ${color.color}" 
                         onclick="selectEyeColor('${color.id}')" title="${color.name}">
                    </div>
                `;
            });
            content += '</div></div>';
            
            content += '</div>';
            return content;
        }

        // 获取身体类型选择内容
        function getBodyContent() {
            const bodyTypes = [
                { id: 'petite', icon: '👩', title: 'Petite', description: 'Small and delicate build' },
                { id: 'slim', icon: '🧘‍♀️', title: 'Slim', description: 'Lean and athletic figure' },
                { id: 'average', icon: '👤', title: 'Average', description: 'Balanced proportions' },
                { id: 'curvy', icon: '💃', title: 'Curvy', description: 'Full hourglass figure' },
                { id: 'voluptuous', icon: '🌹', title: 'Voluptuous', description: 'Generous curves' },
                { id: 'athletic', icon: '🏃‍♀️', title: 'Athletic', description: 'Toned and muscular' },
                { id: 'plus_size', icon: '💕', title: 'Plus Size', description: 'Fuller figure' },
                { id: 'tall_slim', icon: '🗽', title: 'Tall & Slim', description: 'Tall with lean build' }
            ];
            
            let content = '<div class="options-grid icon-grid">';
            bodyTypes.forEach(bodyType => {
                const selected = characterData.bodyType === bodyType.id ? 'selected' : '';
                content += `
                    <div class="option-card icon-card ${selected}" onclick="selectBodyType('${bodyType.id}')">
                        <div class="option-icon">${bodyType.icon}</div>
                        <div class="option-title">${bodyType.title}</div>
                        <div class="option-description">${bodyType.description}</div>
                    </div>
                `;
            });
            content += '</div>';
            return content;
        }

        // 获取性格选择内容
        function getPersonalityContent() {
            const personalities = [
                { id: 'caregiver', icon: '💖', title: 'Caregiver', description: 'Nurturing, protective, and always there to offer comfort.' },
                { id: 'sage', icon: '🧠', title: 'Sage', description: 'Wise, reflective, and a source of guidance.' },
                { id: 'innocent', icon: '⭐', title: 'Innocent', description: 'Optimistic, naive, and sees world with wonder.' },
                { id: 'jester', icon: '🎭', title: 'Jester', description: 'Playful, humorous, and always there to make you laugh.' },
                { id: 'temptress', icon: '💋', title: 'Temptress', description: 'Flirtatious, playful, and always leaving you wanting more.' },
                { id: 'dominant', icon: '👑', title: 'Dominant', description: 'Assertive, controlling, and commanding.' },
                { id: 'submissive', icon: '💕', title: 'Submissive', description: 'Obedient, yielding, and happy to follow.' },
                { id: 'lover', icon: '💗', title: 'Lover', description: 'Romantic, affectionate, and cherishes deep emotional connections.' },
                { id: 'nympho', icon: '🔥', title: 'Nympho', description: 'Insatiable, passionate, and constantly craving intimacy.' },
                { id: 'mean', icon: '❄️', title: 'Mean', description: 'Cold, dismissive, and often sarcastic.' },
                { id: 'confidant', icon: '💝', title: 'Confidant', description: 'Trustworthy, a good listener, and always can offer advice.' },
                { id: 'experimenter', icon: '🔬', title: 'Experimenter', description: 'Curious, willing, and always eager to try new things.' }
            ];
            
            let content = '<div class="options-grid icon-grid">';
            personalities.forEach(personality => {
                const selected = characterData.personality === personality.id ? 'selected' : '';
                content += `
                    <div class="option-card icon-card ${selected}" onclick="selectPersonality('${personality.id}')">
                        <div class="option-icon">${personality.icon}</div>
                        <div class="option-title">${personality.title}</div>
                        <div class="option-description">${personality.description}</div>
                    </div>
                `;
            });
            content += '</div>';
            return content;
        }

        // 获取关系选择内容
        function getRelationshipContent() {
            const relationships = [
                { id: 'stranger', icon: '🕶️', title: 'Stranger', description: 'Someone you just met' },
                { id: 'school_mate', icon: '🎓', title: 'School Mate', description: 'Classmate or study partner' },
                { id: 'colleague', icon: '💼', title: 'Colleague', description: 'Work partner or professional acquaintance' },
                { id: 'mentor', icon: '💎', title: 'Mentor', description: 'Wise guide and teacher' },
                { id: 'girlfriend', icon: '❤️', title: 'Girlfriend', description: 'Romantic partner and lover' },
                { id: 'sex_friend', icon: '♂️', title: 'Sex Friend', description: 'Physical relationship without commitment' },
                { id: 'wife', icon: '💍', title: 'Wife', description: 'Married partner for life' },
                { id: 'mistress', icon: '👸', title: 'Mistress', description: 'Secret romantic relationship' },
                { id: 'friend', icon: '🤝', title: 'Friend', description: 'Close companion and confidant' },
                { id: 'best_friend', icon: '🤜', title: 'Best Friend', description: 'Closest friend who knows everything' },
                { id: 'step_sister', icon: '💛', title: 'Step Sister', description: 'Family member through marriage' },
                { id: 'step_mom', icon: '💖', title: 'Step Mom', description: 'Maternal figure through marriage' }
            ];
            
            let content = '<div class="options-grid icon-grid">';
            relationships.forEach(relationship => {
                const selected = characterData.relationship === relationship.id ? 'selected' : '';
                content += `
                    <div class="option-card icon-card ${selected}" onclick="selectRelationship('${relationship.id}')">
                        <div class="option-icon">${relationship.icon}</div>
                        <div class="option-title">${relationship.title}</div>
                        <div class="option-description">${relationship.description}</div>
                    </div>
                `;
            });
            content += '</div>';
            return content;
        }

        // 获取总结内容
        function getSummaryContent() {
            const getDisplayValue = (key, value) => {
                const mappings = {
                    style: { realistic: 'Realistic', anime: 'Anime' },
                    ethnicity: { asian: 'Asian', caucasian: 'Caucasian', latina: 'Latina', african: 'African', middle_eastern: 'Middle Eastern', mixed: 'Mixed' },
                    hairColor: { 
                        black: 'Black', 
                        dark_brown: 'Dark Brown', 
                        brown: 'Brown', 
                        light_brown: 'Light Brown', 
                        dirty_blonde: 'Dirty Blonde', 
                        blonde: 'Blonde', 
                        strawberry_blonde: 'Strawberry Blonde', 
                        red: 'Auburn Red', 
                        light_red: 'Light Red', 
                        gray: 'Gray', 
                        silver: 'Silver', 
                        white: 'White' 
                    },
                    eyeColor: { 
                        dark_brown: 'Dark Brown', 
                        brown: 'Brown', 
                        hazel: 'Hazel', 
                        amber: 'Amber', 
                        green: 'Green', 
                        blue: 'Blue', 
                        light_blue: 'Light Blue', 
                        gray: 'Gray', 
                        violet: 'Violet' 
                    },
                    bodyType: { 
                        petite: 'Petite', 
                        slim: 'Slim', 
                        average: 'Average', 
                        curvy: 'Curvy', 
                        voluptuous: 'Voluptuous', 
                        athletic: 'Athletic', 
                        plus_size: 'Plus Size', 
                        tall_slim: 'Tall & Slim' 
                    },
                    personality: { caregiver: 'Caregiver', sage: 'Sage', innocent: 'Innocent', jester: 'Jester', temptress: 'Temptress', dominant: 'Dominant', submissive: 'Submissive', lover: 'Lover', nympho: 'Nympho', mean: 'Mean', confidant: 'Confidant', experimenter: 'Experimenter' },
                    relationship: { stranger: 'Stranger', school_mate: 'School Mate', colleague: 'Colleague', mentor: 'Mentor', girlfriend: 'Girlfriend', sex_friend: 'Sex Friend', wife: 'Wife', mistress: 'Mistress', friend: 'Friend', best_friend: 'Best Friend', step_sister: 'Step Sister', step_mom: 'Step Mom' }
                };
                return mappings[key] && mappings[key][value] ? mappings[key][value] : value;
            };
            
            return `
                <div class="summary-container">
                    <div class="summary-section">
                        <div class="summary-title">Basic Information</div>
                        <div class="summary-item">
                            <span class="summary-label">Style:</span>
                            <span class="summary-value">${getDisplayValue('style', characterData.style)}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Ethnicity:</span>
                            <span class="summary-value">${getDisplayValue('ethnicity', characterData.ethnicity)}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Age:</span>
                            <span class="summary-value">${characterData.age}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Relationship:</span>
                            <span class="summary-value">${getDisplayValue('relationship', characterData.relationship)}</span>
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <div class="summary-title">Appearance</div>
                        <div class="summary-item">
                            <span class="summary-label">Hair Color:</span>
                            <span class="summary-value">${getDisplayValue('hairColor', characterData.hairColor)}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Eye Color:</span>
                            <span class="summary-value">${getDisplayValue('eyeColor', characterData.eyeColor)}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Body Type:</span>
                            <span class="summary-value">${getDisplayValue('bodyType', characterData.bodyType)}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Personality:</span>
                            <span class="summary-value">${getDisplayValue('personality', characterData.personality)}</span>
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <div class="summary-title">Character Name</div>
                        <input type="text" class="age-input" id="characterName" value="${characterData.name}" 
                               placeholder="Enter character name..." onchange="updateCharacterName()" 
                               style="width: 100%; margin-top: 10px;">
                    </div>
                </div>
                
                <button class="btn-create" onclick="createCharacter()">Create Character</button>
            `;
        }

        // 选择函数
        function selectStyle(style) {
            characterData.style = style;
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
        }

        function selectEthnicity(ethnicity) {
            characterData.ethnicity = ethnicity;
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
        }

        function selectHairColor(color) {
            characterData.hairColor = color;
            document.querySelectorAll('.color-option').forEach(option => option.classList.remove('selected'));
            event.target.classList.add('selected');
        }



        function selectEyeColor(color) {
            characterData.eyeColor = color;
            document.querySelectorAll('.color-option').forEach(option => option.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        function selectPersonality(personality) {
            characterData.personality = personality;
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
        }

        function selectRelationship(relationship) {
            characterData.relationship = relationship;
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
        }

        function selectBodyType(bodyType) {
            characterData.bodyType = bodyType;
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
        }

        // 年龄控制
        function changeAge(delta) {
            const newAge = characterData.age + delta;
            if (newAge >= 18 && newAge <= 40) {
                characterData.age = newAge;
                document.getElementById('ageInput').value = newAge;
            }
        }

        function updateAge() {
            const age = parseInt(document.getElementById('ageInput').value);
            if (age >= 18 && age <= 40) {
                characterData.age = age;
            }
        }



        // 角色名称更新
        function updateCharacterName() {
            characterData.name = document.getElementById('characterName').value;
        }

        // 导航功能
        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                loadStep(currentStep);
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                loadStep(currentStep);
            }
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentStep === 1;
            
            if (currentStep === totalSteps) {
                nextBtn.style.visibility = 'hidden';  // 改为invisible保持占位
            } else {
                nextBtn.style.visibility = 'visible';
            }
        }

        // 创建角色
        function createCharacter() {
            // 验证必填项
            if (!characterData.style || !characterData.ethnicity || !characterData.bodyType || !characterData.personality || !characterData.relationship) {
                alert('Please complete all required selections before creating your character.');
                return;
            }
            
            if (!characterData.name) {
                alert('Please enter a character name.');
                return;
            }
            
            // 生成随机ID
            const characterId = 'character_' + Date.now();
            
            // 保存角色数据
            const fullCharacterData = {
                id: characterId,
                ...characterData,
                createdAt: new Date().toISOString()
            };
            
            // 保存到本地存储
            localStorage.setItem('newCharacter', JSON.stringify(fullCharacterData));
            
            // 显示成功消息
            alert('Character created successfully!');
            
            // 跳转到聊天页面
            window.location.href = `chat.html?character=${encodeURIComponent(characterData.name)}`;
        }

        // 检查图片是否能正确加载
        function checkImageLoad(ethnicityId, imageUrl) {
            const img = new Image();
            const imageElement = document.getElementById(`ethnicity-image-${ethnicityId}`);
            
            img.onload = function() {
                // 图片加载成功，保持原有样式
                if (imageElement) {
                    imageElement.classList.remove('error');
                }
            };
            
            img.onerror = function() {
                // 图片加载失败，添加错误样式
                if (imageElement) {
                    imageElement.classList.add('error');
                    imageElement.style.backgroundImage = 'none';
                    console.warn(`Failed to load ethnicity image: ${imageUrl}`);
                }
            };
            
            img.src = imageUrl;
        }

        // 导航功能
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const text = this.querySelector('.text').textContent;
                
                if (text === 'Explore') {
                    window.location.href = './index.html';
                } else if (text === 'Chat') {
                    window.location.href = './chat.html';
                } else if (text === 'Dashboard') {
                    window.location.href = './dashboard.html';
                } else if (text === 'Create') {
                    // 当前页面
                    return;
                } else if (text === 'Generate') {
                    window.location.href = './generate.html';
                    return;
                } else {
                    alert(`Navigate to ${text} page\n(功能开发中)`);
                }
            });
        });
    </script>
</body>
</html> 